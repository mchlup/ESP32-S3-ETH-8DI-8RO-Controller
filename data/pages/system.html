<section class="page" id="page-system">
  <div class="pageIntro">
    <div>
      <div class="h2">Systém</div>
      <div class="muted">Režimy, čas, plánování a systémové nástroje.</div>
    </div>
  </div>
  <div id="mount-system">
<div class="tabPage active" id="cfg-io">
          <div class="grid2">
            <div class="card">
              <div class="cardHead">
                <div>
                  <div class="cardTitle">Vstupy</div>
                  <div class="muted">Názvy + aktivní úroveň (LOW/HIGH)</div>
                </div>
                <button class="btn" id="btnSaveInputs">Uložit</button>
              </div>
              <div class="table" id="tblInputs"></div>
            </div>

            <div class="card">
              <div class="cardHead">
                <div>
                  <div class="cardTitle">Relé</div>
                  <div class="muted">Názvy + mapování pro AUTO</div>
                </div>
                <button class="btn" id="btnSaveRelays">Uložit</button>
              </div>
              <div class="table" id="tblRelays"></div>
            </div>
          </div>
        </div>
<div class="tabPage" id="cfg-modes">
          <div class="card">
            <div class="cardHead">
              <div>
                <div class="cardTitle">Režimy (MODE1..MODE5)</div>
                <div class="muted">Každý režim: název, popis, trigger vstup a stavy relé</div>
              </div>
              <button class="btn" id="btnSaveModes">Uložit</button>
            </div>
            <div class="modeGrid" id="modesGrid"></div>
          </div>
        </div>
<div class="tabPage" id="cfg-time">
          <div class="grid2">
            <div class="card">
              <div class="cardHead">
                <div>
                  <div class="cardTitle">Čas & NTP</div>
                  <div class="muted">Konfigurace synchronizace času (NTP). Čas je základ pro časové funkce (plánování režimů, ohřev TUV, noční útlum…)</div>
                </div>
                <button class="btn" id="btnSaveTime">Uložit</button>
              </div>
              <div class="pad">
                <label class="check"><input type="checkbox" id="ntpEnabled"> <span>Povolit NTP</span></label>
                <div class="grid2" style="margin-top:10px">
                  <div class="field">
                    <label>NTP server 1</label>
                    <input id="ntpServer1" type="text" placeholder="pool.ntp.org">
                  </div>
                  <div class="field">
                    <label>NTP server 2</label>
                    <input id="ntpServer2" type="text" placeholder="time.google.com">
                  </div>
                </div>
                <div class="grid2">
                  <div class="field">
                    <label>Time zone (IANA)</label>
                    <input id="ntpTz" type="text" placeholder="Europe/Prague">
                  </div>
                  <div class="field">
                    <label>Interval synchronizace (min)</label>
                    <input id="ntpIntervalMin" type="number" step="1" min="5" max="1440">
                  </div>
                </div>
                <div class="divider"></div>
                <div class="row">
                  <button class="btn ghost" id="btnTryReadTime">Načíst čas ze zařízení</button>
                </div>
                <div class="muted" id="timeInfo" style="margin-top:8px">—</div>
              </div>
            </div>

            <div class="card">
              <div class="cardHead">
                <div>
                  <div class="cardTitle">Stav času</div>
                  <div class="muted">Browser čas je vždy dostupný. Pokud firmware poskytuje /api/time, zobrazí se i čas zařízení.</div>
                </div>
              </div>
              <div class="pad">
                <div class="grid2">
                  <div class="card mini">
                    <div class="muted">Čas v prohlížeči</div>
                    <div class="bigNum" id="browserTime">—</div>
                  </div>
                  <div class="card mini">
                    <div class="muted">Čas zařízení</div>
                    <div class="bigNum" id="deviceTime">—</div>
                  </div>
                </div>
                <div class="muted" style="margin-top:10px">Tip: Pokud zatím firmware /api/time nemá, UI nespadne – jen ukáže „—“.</div>
              </div>
            </div>
          </div>
        </div>
<div class="tabPage" id="cfg-sched">
          <div class="card">
            <div class="cardHead">
              <div>
                <div class="cardTitle">Plánování</div>
                <div class="muted">Časová pravidla uložená do konfigurace. Firmware je může později vyhodnocovat (přepínání režimů, noční útlum, ohřev TUV…).</div>
                <div class="muted" id="schedInputHint" style="margin-top:6px"></div>
              </div>
              <div class="actions">
                <button class="btn ghost" id="btnAddSchedule">Přidat</button>
                <button class="btn" id="btnSaveSchedules">Uložit</button>
              </div>
            </div>
            <div class="pad">
              <div class="table" id="tblSchedules"></div>
            </div>
          </div>
        </div>
<div class="tabPage" id="cfg-buzzer">
          <div class="card">
            <div class="cardHead">
              <div>
                <div class="cardTitle">BUZZER</div>
                <div class="muted">GPIO46 – systémové události + test pípnutí</div>
              </div>
              <button class="btn" id="btnBuzzerSave">Uložit</button>
            </div>
            <div class="grid2">
              <div>
                <label class="check"><input type="checkbox" id="bzEnabled"> <span>Povolit buzzer</span></label>
                <div class="row" style="padding:0 14px 14px">
                  <div class="field">
                    <label>Aktivní úroveň</label>
                    <select id="bzActive">
                      <option value="high">HIGH = zapnuto</option>
                      <option value="low">LOW = zapnuto</option>
                    </select>
                  </div>
                </div>
                <div class="muted" style="padding:0 14px">Systémové události:</div>
                <div class="table" id="bzEvents"></div>
              </div>
              <div>
                <div class="muted" style="padding:14px 14px 0">Test:</div>
                <div class="row" style="gap:8px; flex-wrap:wrap">
                  <button class="btn" id="btnBeepShort">Krátké</button>
                  <button class="btn" id="btnBeepLong">Dlouhé</button>
                  <button class="btn" id="btnBeepDouble">Dvojité</button>
                  <button class="btn" id="btnBeepTriple">Trojité</button>
                  <button class="btn bad" id="btnBeepStop">Stop</button>
                </div>
              </div>
            </div>
          </div>
        </div>
<div class="tabPage" id="cfg-valvecal">
          <div class="card">
            <div class="cardHead">
              <div>
                <div class="cardTitle">Kalibrace trojcestných ventilů</div>
                <div class="muted">Pomocné nástroje pro změřeni doby přeběhu (sekundy) a uložení do šablony výstupu. Používá ovládání relé přes /api/mode_ctrl.</div>
              </div>
              <div class="actions">
                <button class="btn" id="btnSaveValveCalib">Uložit</button>
              </div>
            </div>
            <div class="pad">
              <div class="muted" style="margin-bottom:10px">
                Zobrazí se pouze relé s rolí <b>Trojcestný ventil 2‑bod</b> (ve „Funkce I/O“). Tlačítko <b>Start měření</b> sepne relé a spustí stopky, <b>Stop</b> relé vypne a uloží naměřený čas jako „Doba přeběhu“.
              </div>
              <div class="table" id="tblValveCalib"></div>
            </div>
          </div>
        </div>
<div class="tabPage" id="cfg-opentherm">
  <div class="grid2">
    <div class="card">
      <div class="cardHead">
        <div>
          <div class="cardTitle">OpenTherm (kotel)</div>
          <div class="muted">Základní podpora (config + status API). Pro reálnou komunikaci je potřeba OpenTherm transceiver.</div>
        </div>
        <div>
          <button class="btn" id="btnSaveOpenTherm">Uložit</button>
        </div>
      </div>

      

      <div class="ioGrid">
        <div class="ioRow">
          <div class="ioLabel">Povolit</div>
          <div class="ioValue">
            <label class="switch"><input type="checkbox" id="otEnabled"><span class="slider"></span></label>
          </div>
        </div>

        <div class="ioRow">
          <div class="ioLabel">Režim</div>
          <div class="ioValue">
            <select id="otMode">
              <option value="off">Vypnuto</option>
              <option value="manual">Manuální setpoint</option>
              <option value="equitherm">Ekviterm → setpoint</option>
            </select>
          </div>
        </div>

        <div class="ioRow">
          <div class="ioLabel">GPIO (RX/TX)</div>
          <div class="ioValue">
            <div class="row2">
              <div><label class="mini">IN (RX)</label><input id="otInPin" type="number" min="-1" max="48" step="1" placeholder="-1 = nevýběr"></div>
              <div><label class="mini">OUT (TX)</label><input id="otOutPin" type="number" min="-1" max="48" step="1" placeholder="-1 = nevýběr"></div>
            </div>
          </div>
        </div>

        <div class="ioRow">
          <div class="ioLabel">Polling</div>
          <div class="ioValue">
            <div class="row2">
              <div><label class="mini">Interval (ms)</label><input id="otPollMs" type="number" min="200" max="10000" step="100"></div>
              <div><label class="mini">CH enable</label>
                <label class="switch"><input type="checkbox" id="otChEnable"><span class="slider"></span></label>
              </div>
            </div>
          </div>
        </div>

        <div class="ioRow">
          <div class="ioLabel">Setpoint (manuál)</div>
          <div class="ioValue">
            <input id="otManualSetpoint" type="number" min="10" max="90" step="0.5">
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="cardHead">
        <div>
          <div class="cardTitle">Stav</div>
          <div class="muted">Diagnostika komunikace</div>
        </div>
      </div>
      <div class="pad" id="otStatus"></div>
    </div>
  </div>
</div>
<div class="tabPage" id="cfg-json">
          <div class="card">
            <div class="cardHead">
              <div>
                <div class="cardTitle">Konfigurace jako JSON</div>
                <div class="muted">Zachová 100% kompatibilitu i pro položky, které UI neukazuje.</div>
              </div>
              <div class="btnRow">
                <button class="btn ghost" id="btnFmtCfg">Formátovat</button>
                <button class="btn" id="btnSaveCfgJson">Uložit JSON</button>
              </div>
            </div>
            <textarea id="cfgJson" spellcheck="false" class="code" rows="18"></textarea>
          </div>
        </div>
  </div>
  <div class="grid2">
    <div class="card">
      <div class="cardHead">
        <div>
          <div class="cardTitle">Restart</div>
          <div class="muted">Pošle /api/reboot</div>
        </div>
      </div>
      <div class="form">
        <button class="btn bad" id="btnReboot">Restartovat zařízení</button>
        <div class="muted">Po restartu se stránka může na chvíli odpojit.</div>
      </div>
    </div>

    <div class="card">
      <div class="cardHead">
        <div>
          <div class="cardTitle">Rychlé odkazy</div>
          <div class="muted">Pomocné stránky</div>
        </div>
      </div>
      <div class="form">
        <a class="link" href="/update.html">update.html</a>
        <a class="link" href="/ble.html">ble.html</a>
      </div>
    </div>
  </div>
</section>
